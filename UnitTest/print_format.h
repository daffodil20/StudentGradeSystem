int calculate_display_width(const wchar_t* str);